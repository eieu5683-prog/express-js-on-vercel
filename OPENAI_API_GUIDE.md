# OpenAI API 연동 가이드

PSST 리포트 생성 기능을 위한 OpenAI API 연동 가이드입니다.

## 환경 변수 설정

### 1. .env.local 파일 생성

프로젝트 루트 폴더에 `.env.local` 파일을 생성하고 다음 내용을 추가하세요:

```bash
OPENAI_API_KEY=sk-proj-본인의_오픈AI_키_입력
```

### 2. OpenAI API 키 발급

1. [OpenAI Platform](https://platform.openai.com/api-keys) 접속
2. 로그인 후 "API keys" 메뉴 클릭
3. "Create new secret key" 클릭
4. 생성된 키를 복사하여 `.env.local` 파일에 붙여넣기

### 3. 보안 주의사항

- `.env.local` 파일은 절대 Git에 커밋하지 마세요
- `.gitignore`에 이미 포함되어 있습니다
- 프로덕션 환경에서는 환경 변수로 관리하세요

## API 엔드포인트

### POST /api/generate-psst

PSST 리포트를 생성하는 API입니다.

**요청 본문:**
```json
{
  "ksicCode": "58221",
  "userIdea": "AI 기반 자동화 시스템 개발"
}
```

**응답:**
```json
{
  "success": true,
  "data": "생성된 PSST 리포트 내용...",
  "notice": "본 초안은 나랏돈네비 AI 기술(GPT-4o)을 활용하여 작성되었습니다.",
  "metadata": {
    "ksicCode": "58221",
    "industryName": "시스템 소프트웨어 개발",
    "grade": "S",
    "generatedAt": "2026-01-01T00:00:00.000Z"
  }
}
```

## 사용 방법

### 1. 리포트 페이지 접속

```
/report/view?code=58221&idea=사업 아이디어
```

**파라미터:**
- `code`: 업종코드 (필수)
- `idea`: 사용자 아이디어 (선택사항)

### 2. 결제 확인

리포트 페이지는 결제가 완료된 경우에만 접근 가능합니다.

- 결제 미완료: 오류 메시지 표시
- 결제 완료: AI 리포트 자동 생성

### 3. 리포트 생성 프로세스

1. **업종코드 확인**: `ksicData.ts`에서 업종 정보 조회
2. **전문가 솔루션 가져오기**: 엑셀 데이터에서 전문가 핵심 전략 추출
3. **프롬프트 조립**: 시스템 프롬프트 + 사용자 프롬프트
4. **OpenAI API 호출**: GPT-4o 모델 사용
5. **결과 반환**: 생성된 PSST 리포트 표시

## 프롬프트 구조

### 시스템 프롬프트

```
당신은 중소벤처기업부 심사위원이며, 15년 차 창업 컨설턴트입니다. 
제공된 정보를 바탕으로 정부 지원사업 표준 서식(1-1, 1-2 등)에 맞춰 풍성하고 전문적인 PSST 본문을 작성하십시오. 
모든 수치는 논리적으로 추론하여 구체적인 숫자(%)로 제시하고, 절대 빈칸(○○)을 만들지 마십시오.
```

### 사용자 프롬프트

```
- 업종: {업종명} ({업종코드})
- 예비창업자 아이템: {사용자 아이디어}
- 전문가 핵심 전략: {전문가 솔루션}
- 예상 지원금액: {지원금액}
- 가점 요소: 디지털 전환, 지역경제 활성화, ESG 경영
- 작성 형식: 
  1. 문제인식(1-1, 1-2)
  2. 해결방안(2-1, 2-2)
  3. 성장전략(3-1, 3-2)
  4. 팀 구성(4-1, 4-2)
```

## 리포트 형식

생성된 리포트는 다음 형식을 따릅니다:

### 1. 문제인식 (1-1, 1-2)
- 현재 시장의 불편함
- 사회적/경제적 이유
- 해결의 시급성

### 2. 해결방안 (2-1, 2-2)
- 핵심 기술
- 주요 기능
- 경쟁사 대비 차별화 포인트
- 경쟁 우위

### 3. 성장전략 (3-1, 3-2)
- 수익 창출 방안
- 수익원
- 시장 진입 전략
- 확장 계획
- 3년 내 시장 점유율 목표

### 4. 팀 구성 (4-1, 4-2)
- 대표자 정보
- 핵심 팀원
- 네트워크 및 파트너십
- 팀 역량

## AI 표기법 준수

생성된 리포트 하단에 자동으로 다음 문구가 포함됩니다:

> 본 초안은 나랏돈네비 AI 기술(GPT-4o)을 활용하여 작성되었습니다.
> (2026년 1월 23일부터 시행되는 AI 생성 콘텐츠 표기 의무화 규정 준수)

## 기능

### 1. 로딩 상태
- 리포트 생성 중 로딩 스피너 표시
- "심사위원의 시각으로 합격 리포트를 분석 중입니다..." 메시지

### 2. 에러 처리
- 업종코드 없음
- 결제 미완료
- OpenAI API 오류
- 네트워크 오류

### 3. 리포트 표시
- 마크다운 형식 지원
- 복사하기 버튼
- HWP 다운로드 버튼
- AI 표기법 준수 문구

## 비용 관리

### GPT-4o 모델 비용
- 입력 토큰: 약 $2.50 / 1M tokens
- 출력 토큰: 약 $10.00 / 1M tokens

### 예상 비용
- 리포트 1건 생성: 약 $0.10 ~ $0.30
- 월 100건 생성: 약 $10 ~ $30

### 비용 절감 팁
1. **토큰 제한**: `max_tokens` 설정으로 출력 길이 제한
2. **캐싱**: 동일한 입력에 대한 결과 캐싱
3. **모델 선택**: 필요에 따라 GPT-3.5-turbo 사용 고려

## 문제 해결

### OpenAI API 키 오류
```
Error: OPENAI_API_KEY가 설정되지 않았습니다.
```
**해결:** `.env.local` 파일에 API 키를 올바르게 설정했는지 확인

### API 호출 실패
```
Error: AI 서비스 오류가 발생했습니다.
```
**해결:**
1. API 키가 유효한지 확인
2. OpenAI 계정에 충분한 크레딧이 있는지 확인
3. 네트워크 연결 확인

### 리포트 생성 실패
```
Error: 리포트 생성에 실패했습니다.
```
**해결:**
1. 브라우저 콘솔에서 상세 오류 확인
2. 서버 로그 확인
3. OpenAI API 상태 확인

## 보안 고려사항

1. **API 키 보호**
   - 클라이언트 사이드에 노출하지 않음
   - 서버 사이드에서만 사용
   - 환경 변수로 관리

2. **요청 제한**
   - Rate limiting 구현 권장
   - 사용자당 일일 생성 횟수 제한

3. **입력 검증**
   - 업종코드 형식 검증
   - 사용자 아이디어 길이 제한
   - 악의적인 입력 필터링

## 향후 개선 사항

1. **프롬프트 최적화**
   - 업종별 맞춤 프롬프트
   - 더 구체적인 지시사항

2. **캐싱 시스템**
   - 동일 입력에 대한 결과 캐싱
   - 비용 절감 및 응답 속도 개선

3. **다중 모델 지원**
   - GPT-4o, GPT-3.5-turbo 선택 가능
   - Claude, Gemini 등 다른 모델 지원

4. **리포트 편집 기능**
   - 생성된 리포트 수정 가능
   - 버전 관리

## 참고 자료

- [OpenAI API 문서](https://platform.openai.com/docs)
- [GPT-4o 모델 정보](https://platform.openai.com/docs/models/gpt-4o)
- `app/api/generate-psst/route.ts`: API 라우트 구현
- `app/report/view/page.tsx`: 리포트 페이지 구현

